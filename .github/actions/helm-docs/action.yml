# Based on Helm-docs utility https://github.com/norwoodj/helm-docs
name: 'helm-docs'
description: Generate Helm docs

inputs:
  chart-path:
    required: false
    description: set custom chart path
    default: './'
  git-token:
    description: the git token used to operate on the git repository. If not specified it's loaded from the git credentials file
    required: true
    default: ''
  git-username:
    description: the git username used to operate on the git repository. If not specified it's loaded from the git credentials file
    required: false
    default: ''
  git-author-name:
    description: the user name to git commit
    required: false
    default: ''
  git-author-email:
    description: the user email to git commit
    required: false
    default: ''
runs:
  using: composite
  steps:
    - name: helm package
      env:
        GITHUB_TOKEN: ${{ inputs.git-token }}
      run: |
        wget https://github.com/norwoodj/helm-docs/releases/download/v1.11.0/helm-docs_1.11.0_Linux_x86_64.deb
        sudo apt install -y ./helm-docs_1.11.0_Linux_x86_64.deb
        rm -f ./helm-docs_1.11.0_Linux_x86_64.deb
        helm-docs .
        echo "----------------docs generated"
        if [[ $(git diff) != "" ]]; then
          git config --global user.email "noreplay@softcannery.com"
          git config --global user.name "Actions bot"
          git add -A
          git commit -m "update Helm Docs"
          git push
        fi
      shell: bash
      working-directory: ${{ inputs.chart-path }}